function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),AutoComplete=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"autocomplete__item",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,e),this.input=t.querySelector(".autocomplete__input"),this.url=n,this.dropdown=t.querySelector(".autocomplete__list"),this.autocomplete_item_id=r}return _createClass(e,[{key:"getUrl",value:function(){var e=this.input.getAttribute("data-url");if(null===e){if(!this.url)throw new Error("Set autocomplete Url");e=this.url}return e}},{key:"get",value:function(){var e=this.input.value;e.length>2?this.makeRequest(e):this.closeDropdown()}},{key:"makeRequest",value:function(e){var t=this;$.get(this.getUrl(),{query:e,type:this.input.getAttribute("search")}).done(function(e){e.length?t.createDropdown(e):t.closeDropdown()})}},{key:"getItemTemplate",value:function(e){return _.template(document.getElementById(e).innerHTML)}},{key:"createDropdown",value:function(e){var t=this,r="";e.forEach(function(e){var n=t.getItemTemplate(t.autocomplete_item_id);r+=n(e)}),this.dropdown.querySelector(".list").innerHTML=r,this.dropdown.classList.add("show")}},{key:"clearInputAttributes",value:function(){for(var e in this.input.dataset)"url"!==e&&delete this.input.dataset[e]}},{key:"init",value:function(){var e=this;this.input.addEventListener("input",function(t){e.clearInputAttributes(),e.get(t.target)}),this.input.addEventListener("focusout",function(t){setTimeout(function(){e.closeDropdown()},300)}),this.dropdown.addEventListener("click",function(t){e.setInputValue(t.target)})}},{key:"closeDropdown",value:function(){this.dropdown.querySelector(".list").scrollTo(0,0),this.dropdown.classList.remove("show")}},{key:"setInputValue",value:function(e){this.input.value=e.innerText;for(var t in e.dataset)this.input.setAttribute("data-"+t,e.dataset[t]);this.closeDropdown()}}]),e}(),LVG=function(){function e(){_classCallCheck(this,e),this.container=document.querySelector(".page--lvg"),this.autocompletes=[],this.user={}}return _createClass(e,[{key:"init",value:function(){this.initAutocomplete(),this.container.querySelectorAll(".form--input input").forEach(function(e){e.addEventListener("input",function(e){e.target.classList.remove("error")})}),$('input[name="phone"]').mask("+7 (999) 999-9999"),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}})}},{key:"fillUser",value:function(){var e=document.querySelector(".form--begin"),t=this;e.querySelectorAll(".form--input").forEach(function(e){e=e.querySelector("input"),null!==e.getAttribute("data-id")?t.user[e.getAttribute("name")]={value:e.value,id:e.getAttribute("data-id")}:t.user[e.getAttribute("name")]=e.value}),e.querySelectorAll(".form--checkbox input").forEach(function(e){t.user[e.getAttribute("name")]=e.checked})}},{key:"saveUser",value:function(e){var t=this;$.post("/actions/best-doctor-2018/create",t.user).done(function(r){200==r.code&&(t.user.doctor_id=r.data.doctor_id,t.goToStep(e.getAttribute("data-next-step"),"begin"))}).fail(function(e){console.log(e)})}},{key:"stepBegin",value:function(e){var t=this.validateBeginForm();!0===t?(this.fillUser(),this.saveUser(e)):Array.isArray(t)?t.forEach(function(e){console.log(e)}):console.log(t)}},{key:"stepSendSms",value:function(e){var t=this.validateRegisterForm();if(!0===t){var r=document.querySelector(".form--register");this.user.email=r.querySelector('.form--input input[name="email"]').value,this.user.phone=r.querySelector('.form--input input[name="phone"]').value,this.sendSms(e)}else Array.isArray(t)?t.forEach(function(e){console.log(e)}):console.log(t)}},{key:"sendSms",value:function(e){var t=this;$.post("/actions/best-doctor-2018/register",t.user).done(function(e){200==e.code&&t.showSmsCheck()}).fail(function(e){e=e.responseJSON,e.msg.hasOwnProperty("validator")?alert(e.msg.validator.phone[0]):alert(e.msg)})}},{key:"showSmsCheck",value:function(){var e=document.querySelector(".form--register");e.querySelector(".smscheck").classList.remove("hidden"),e.querySelector('.btn[data-step="SendSms"]').setAttribute("data-step","ValidateSms")}},{key:"stepValidateSms",value:function(e){var t=this,r=document.querySelector(".form--register");$.post("/actions/best-doctor-2018/check",{user:t.user,code:r.querySelector(".smscheck input").value}).done(function(e){if(200==e.code)window.location.href="/actions/best-doctor-2018/vote";else if(401==e.code){var t=confirm(e.msg);t&&(window.location.href="/actions/best-doctor-2018/vote")}}).fail(function(e){e=e.responseJSON,alert(e.msg)})}},{key:"goToStep",value:function(e,t){var r=this.container.querySelector(".form--"+t),n=this.container.querySelector(".form--"+e);r.classList.add("hide"),setTimeout(function(){n.classList.remove("hide")},200)}},{key:"validateBeginForm",value:function(){var e=this,t=document.querySelector(".form--begin"),r=[],n=["medcenter_name"];return t.querySelectorAll(".form--input").forEach(function(t){var o=t.querySelector("input"),i=t.querySelector("label");n.includes(o.name)||o.value.trim().length||(e.markAsError(o),r.push((null===i?o.getAttribute("name"):i.innerText)+" не заполнено"))}),!r.length||r}},{key:"validateRegisterForm",value:function(){var e=this,t=[],r=document.querySelector(".form--register"),n=r.querySelector('.form--input input[name="phone"]');return n.value.trim().length||(e.markAsError(n),t.push(n.getAttribute("name")+" не заполнено")),!t.length||t}},{key:"markAsError",value:function(e){e.classList.add("error")}},{key:"initAutocomplete",value:function(){var e=this;this.container.querySelectorAll(".autocomplete").forEach(function(t){var r=new AutoComplete(t);r.init(),e.autocompletes.push(r)}),this.container.querySelectorAll(".form--buttons .btn").forEach(function(t){t.addEventListener("click",function(t){var r=t.target;e["step"+r.getAttribute("data-step")](r)})})}}]),e}();if(document.querySelector(".page--lvg__main")){var lvg=new LVG;lvg.init()}var LVGVote=function(){function e(){_classCallCheck(this,e),this.container=document.querySelector(".page--lvg"),this.autocompletes=[],this.users=[],this.current=3,this.limit=5}return _createClass(e,[{key:"initAutocomplete",value:function(){var e=this;this.container.querySelectorAll(".autocomplete__lastname").forEach(function(t){e.initLastnameAutocomplete(t,e)}),this.container.querySelectorAll(".autocomplete__skill").forEach(function(t){e.initSkillAutocomplete(t,e)})}},{key:"initSkillAutocomplete",value:function(e,t){var r=new AutoComplete(e,"autocomplete__item--skill");r.init(),t.autocompletes.push(r)}},{key:"initLastnameAutocomplete",value:function(e,t){var r=new AutoComplete(e);r.setInputValue=function(e){var t=e.closest(".form--row"),r=t.querySelector('input[name="skill"]'),n=t.querySelector('input[name="firstname"]');n.value=e.querySelector(".firstname").innerText,n.classList.remove("error");var o=t.querySelector('input[name="lastname"]');o.value=e.querySelector(".lastname").innerText,o.classList.remove("error");var i=t.querySelector('input[name="middlename"]');i.value=e.querySelector(".middlename").innerText,i.classList.remove("error");for(var a in e.dataset)"skill"==a?(r.value=e.dataset[a],r.setAttribute("data-id",e.dataset.skill_id),r.classList.remove("error")):this.input.setAttribute("data-"+a,e.dataset[a]);this.closeDropdown()},r.init(),t.autocompletes.push(r)}},{key:"initAddDoctor",value:function(){var e=this;this.container.querySelector(".add_doctor").addEventListener("click",function(t){if(e.current<5){var r=_.template(document.getElementById("form--row").innerHTML),n=e.parseHTML(r());e.container.querySelector(".vote--form .additional--rows").appendChild(n),e.initLastnameAutocomplete(n.querySelector(".autocomplete__lastname"),e),e.initSkillAutocomplete(n.querySelector(".autocomplete__skill"),e),e.current++}})}},{key:"validateForm",value:function(){var e=this,t=this.container.querySelectorAll(".form--row"),r=[];return this.users=[],t.forEach(function(t){if(!t.classList.contains("add_doctor")){var n=e.validateRow(t);n?e.addUser(t):r.push(n)}}),!r.length||r}},{key:"addUser",value:function(e){var t=e.querySelectorAll(".form--input"),r={};t.forEach(function(e){var t=e.querySelector("input");null!==t.getAttribute("data-id")?r[t.getAttribute("name")]={value:t.value,id:t.getAttribute("data-id")}:r[t.getAttribute("name")]=t.value}),this.users.push(r)}},{key:"validateRow",value:function(e){var t=this,r=[],n={};if(e.querySelectorAll(".form--input").forEach(function(e){var o=e.querySelector("label"),i=e.querySelector("input");i.value.trim().length?null!==i.getAttribute("data-id")?n[i.getAttribute("name")]={value:i.value,id:i.getAttribute("data-id")}:n[i.getAttribute("name")]=i.value:(t.markAsError(i),i.placeholder="Заполните это поле",r.push((null===o?i.getAttribute("name"):o.innerText)+" не заполнено"))}),_.has(n,"lastname.id")){var o=_.filter(this.users,{lastname:{id:n.lastname.id}});if(o.length&&(_.isEqual(n,_.first(o))||n.lastname.id==_.first(o).lastname.id))return t.cleanRow(e),confirm("Вы не можете голосовать дважды за одного врача"),!1}return!r.length}},{key:"showEnd",value:function(){var e=this.container.querySelector(".main"),t=this.container.querySelector(".end");e.classList.add("hide"),setTimeout(function(){t.classList.remove("hide")},200)}},{key:"save",value:function(){var e=this;$.post("/actions/best-doctor-2018/postVote",{users:e.users}).done(function(t){200==t.code&&e.showEnd()}).fail(function(t){t=t.responseJSON,alert(t.msg),419==t.code&&e.showEnd()})}},{key:"cleanRow",value:function(e){var t=this;e.querySelectorAll("input").forEach(function(e){e.value="",t.markAsError(e),e.placeholder="Заполните это поле"})}},{key:"saveForm",value:function(){var e=this.validateForm();!0===e?this.save():Array.isArray(e)?e.forEach(function(e){console.log(e)}):console.log(e)}},{key:"markAsError",value:function(e){e.classList.add("error")}},{key:"parseHTML",value:function(e){var t=document.implementation.createHTMLDocument();return t.body.innerHTML=e,t.body.children[0]}},{key:"initVoteButton",value:function(){var e=this;this.container.querySelector(".vote").addEventListener("click",function(t){e.saveForm()})}},{key:"init",value:function(){this.initAutocomplete(),this.initAddDoctor(),this.initVoteButton(),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),this.container.querySelectorAll(".form--input input").forEach(function(e){e.addEventListener("input",function(e){e.target.placeholder="",e.target.classList.remove("error")})})}}]),e}();if(document.querySelector(".page--lvg__vote")){var lvg_vote=new LVGVote;lvg_vote.init()}